<div class="row blur-on-modal">
    <div class="col-md-10">
        <div class="row marketing">
            <!--    <div class="control-panel well well-lg">
                    <form ng-submit="addNewTask(newTask.text)">
                        <input class="form-control" type="text" placeholder="New Task" ng-model="newTask.text" />
                        <button type="submit" class="btn btn-default btn-block">Add Task</button>
                    </form>
                </div>
            -->
            <div class="well well-sm row">
                <form class="form-inline" role="form">
                    <div class="form-group">
                        <label class="col-md-2 control-label" for="searchInput">Search</label>
                        <div class="col-md-10">
                            <input type="search" ng-model="search.title" class="form-control" id="searchInput" placeholder="Search task">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-2 control-label" for="sortSelect">Sort by</label>
                        <div class="col-md-10">
                            <select ng-init="taskOrderPredicate = taskOrderPredicate || orderPredicates[0]" ng-model="taskOrderPredicate" ng-options="predicate.displayOption for predicate in orderPredicates"></select>
                        </div>
                    </div>
                </form>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-4"><a ng-class="statusFilterVal[0] && !statusFilterVal[1] ? 'lead' : ''" ng-click="setStatusFilter(0)">Active</a></div>
                        <div class="col-md-4"><a ng-class="statusFilterVal[1] && !statusFilterVal[0] ? 'lead' : ''" ng-click="setStatusFilter(1)">Completed</a></div>
                        <div class="col-md-4"><a ng-class="statusFilterVal[0] && statusFilterVal[1] ? 'lead' : ''" ng-click="setStatusFilter(2)">All</a></div>
                    </div>
                </div>
                <div class="panel-body">
                    <div>
                        <ul class="list-inline">
                            <li>Show:</li>
                            <li><div class="checkbox"><label><input type="checkbox" ng-model="priorityFilterVal[0]"/><span class="text-success">Low</span></label></div></li>
                            <li><div class="checkbox"><label><input type="checkbox" ng-model="priorityFilterVal[1]"/><span class="text-info">Normal</span></label></div></li>
                            <li><div class="checkbox"><label><input type="checkbox" ng-model="priorityFilterVal[2]"/><span class="text-warning">High</span></label></div></li>
                            <li><div class="checkbox"><label><input type="checkbox" ng-model="priorityFilterVal[3]"/><span class="text-danger">Urgent</span></label></div></li>
                            <li><div class="checkbox"><label><input type="checkbox" ng-model="statusFilterVal[2]"/><span class="text-primaryr">Archived</span></label></div></li>
                        </ul>
                    </div>
                    <div class="row">
                        <div>
                            <ul class="task-list">
                                <li ng-repeat="task in tasks| filter:{status:0} | filter:search | filter:priorityFilter | filter:statusFilter | orderBy:taskOrderPredicate.pred" ng-cloak>
                                    <div class="task-card" style="background-color: {{priorityColour[task.priority]}}">
                                        <span class="day"><span class="text-{{priorityCss[task.priority]}}"><span class="fa fa-circle"></span></span> {{priorityText(task.priority)}} priority</span>
                                        <span class="month" ng-show="!isDone(task)"><span>{{displayDeadline(task)}}</span></span>
                                        <span class="month" ng-show="isDone(task)"><span>Done!</span></span>
                                        <span ng-class="!isDone(task) ? 'mark-done' : 'task-completed'" ng-click="toggleStatus(task)"><span class="glyphicon glyphicon-ok"></span></span>
                                    </div>
                                    <div class="info" ng-style="isActive(task) ? 'height: 100 % ' : ''">
                                        <h2 class="title" ng-class="isDone(task) ? 'title-completed' : ''">{{task.title}}</h2>
                                        <p class="desc">{{task.description}}</p>
                                        <ul ng-show="!isActive(task)">
                                            <li ng-click="toggleaActiveState(task)" style="width:50%;"><span class="glyphicon glyphicon-chevron-down"></span></li>
                                            <li style="width:50%;"><span class="text-muted">Added <span am-time-ago="task.created_at"></span></span></li>
                                        </ul>
                                    </div>
                                    <div class="social">
                                        <ul>
                                            <li class="edit-task-icon side-icons"><a ng-click="editTask(task)"><span class="glyphicon glyphicon-pencil"></span></a></li>
                                            <li class="delete-task-icon side-icons"><a ng-click="removeTask(task)"><span class="glyphicon glyphicon-remove"></span></a></li>
                                            <li class="archive-task-icon side-icons"><a ng-click="archiveTask(task)"><span class="glyphicon glyphicon-compressed"></span></a></li>
                                        </ul>
                                    </div>
                                    <div ng-show="isActive(task)" class="task-extra">
                                        <!--<div>
                                            <span>Add members:
                                                <select ng-model="task.newMember" ng-options="user.displayName for user in candidateMembers(task)" style="width: 50%;"></select>
                                            </span>
                                            <input type="button" ng-click="addMember(task,[task.newMember.id])" value="Add" id="add-mem-btn">
                                            <ul class="list-inline">
                                                <li ng-repeat="member in task.members">
                                                    <span class="">
                                                        {{member.displayName}}
                                                        <span ng-show="me.id != member" ng-click="removeMember(task, member)" class="glyphicon glyphicon-remove"></span>
                                                    </span>
                                                </li>
                                            </ul>
                                        </div>
                                        -->
                                        <div>
                                            <span class="lead">
                                                Members:
                                            </span>
                                            <ui-select multiple ng-model="task.members" theme="bootstrap" ng-disabled="disabled" on-select="memberSelected(task,$item)" on-remove="memberRemove(task,$item)">
                                                <ui-select-match placeholder="Add members...">
                                                    <span class="noselect">
                                                        <img class="[ img-circle pull-left ]" src="https://lh4.googleusercontent.com/-nns6X6AAgjg/AAAAAAAAAAI/AAAAAAAAAAA/1ZYdx_kXYBU/s32-c/photo.jpg" alt="" />
                                                        {{$item.displayName}}
                                                    </span>
                                                </ui-select-match>
                                              <ui-select-choices repeat="user in candidateMembers(task) | propsFilter: {displayName: $select.search}">
                                                <div ng-bind-html="user.displayName | highlight: $select.search"></div>
                                              </ui-select-choices>
                                            </ui-select>
                                        </div>
                                        <div>
                                            <span class="lead">Assign to:
                                                <select ng-model="task.newAssignee" ng-options="user.displayName for user in candidateAssignees(task)" style="width: 50%;"></select>
                                                    </span>
                                            <input type="button" ng-click="addAssignee(task,[task.newAssignee.id])" value="Add">
                                            <ul class="list-inline">
                                                <li ng-repeat="assignee in task.assignees">
                                                    <span class="">
                                                        {{(users| filter:{id:assignee})[0].displayName}}
                                                        <span ng-click="removeAssignee(task, assignee)" class="glyphicon glyphicon-remove"></span>
                                                    </span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div>
                                            <textarea ng-model="task.newComment" class="input-comment form-control" rows="4"></textarea>
                                            <button class="btn btn-default" ng-click="addComment(task, task.newComment)">Comment</button>
                                            <p class="text-muted"><small>{{500 - task.newComment.length}} left</small></p>
                                        </div>
                                        <!-- Comments repeat-->
                                        <div ng-repeat="comment in task.comments" ng-cloak>
                                            <div class="[ panel panel-default ] panel-google-plus">
                                                <div class="panel-heading">
                                                    <img class="[ img-circle pull-left ]" src="https://lh4.googleusercontent.com/-nns6X6AAgjg/AAAAAAAAAAI/AAAAAAAAAAA/1ZYdx_kXYBU/s32-c/photo.jpg" alt="" />
                                                    <h3>{{userById(comment.user_id).displayName}}</h3>
                                                    <h5><span am-time-ago="comment.created_at"></span> </h5>
                                                </div>
                                                <div class="panel-body">
                                                    <p>{{comment.text}}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                <li ng-repeat="task in tasks | filter:{status:1} | filter:search | filter:priorityFilter | filter:statusFilter | orderBy:taskOrderPredicate.pred" ng-cloak>
                                    <div class="task-card" style="background-color: {{priorityColour[task.priority]}}">
                                        <span class="day"><span class="text-{{priorityCss[task.priority]}}"><span class="fa fa-circle"></span></span> {{priorityText(task.priority)}} priority</span>
                                        <span class="month" ng-show="!isDone(task)"><span>{{displayDeadline(task)}}</span></span>
                                        <span class="month" ng-show="isDone(task)"><span>Done!</span></span>
                                        <span ng-class="!isDone(task) ? 'mark-done' : 'task-completed'" ng-click="toggleStatus(task)"><span class="glyphicon glyphicon-ok"></span></span>
                                    </div>
                                    <div class="info" ng-style="isActive(task) ? 'height: 100 % ' : ''">
                                        <h2 class="title" ng-class="isDone(task) ? 'title-completed' : ''">{{task.title}}</h2>
                                        <p class="desc">{{task.description}}</p>
                                        <ul ng-show="!isActive(task)">
                                            <li ng-click="toggleaActiveState(task)" style="width:50%;"><span class="glyphicon glyphicon-chevron-down"></span></li>
                                            <li style="width:50%;"><span class="text-muted">Added <span am-time-ago="task.created_at"></span></span></li>
                                        </ul>
                                    </div>
                                    <div class="social">
                                        <ul>
                                            <li class="edit-task-icon side-icons"><a ng-click="editTask(task)"><span class="glyphicon glyphicon-pencil"></span></a></li>
                                            <li class="delete-task-icon side-icons"><a ng-click="removeTask(task)"><span class="glyphicon glyphicon-remove"></span></a></li>
                                            <li class="archive-task-icon side-icons"><a ng-click="archiveTask(task)"><span class="glyphicon glyphicon-compressed"></span></a></li>
                                        </ul>
                                    </div>
                                    <div ng-show="isActive(task)" class="task-extra">
                                        <div>
                                            <ul class="list-inline">
                                                <li ng-repeat="member in task.members">
                                                    <span class="">
                                                        {{(users| filter:{id:member})[0].displayName}}
                                                    </span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div>
                                            <textarea ng-model="task.newComment" class="input-comment form-control" rows="4"></textarea>
                                            <button ng-click="addComment(task, task.newComment)">Comment</button>
                                            <p class="text-muted"><small>{{500 - task.newComment.length}} left</small></p>
                                        </div>
                                        <!-- Comments repeat-->
                                        <div ng-repeat="comment in task.comments" ng-cloak>
                                            <div class="[ panel panel-default ] panel-google-plus">
                                                <div class="panel-heading">
                                                    <img class="[ img-circle pull-left ]" src="https://lh4.googleusercontent.com/-nns6X6AAgjg/AAAAAAAAAAI/AAAAAAAAAAA/1ZYdx_kXYBU/s32-c/photo.jpg" alt="" />
                                                    <h3>{{userById(comment.user_id).displayName}}</h3>
                                                    <h5><span am-time-ago="comment.created_at"></span> </h5>
                                                </div>
                                                <div class="panel-body">
                                                    <p>{{comment.text}}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--    <div class="col-md-2">
            <div class="sidebar-nav-fixed pull-right affix">
                <div class="well">
                    <div class="nav">
                        <div class="nav-header">People</div>
                        <div style="display:block;" ng-repeat="user in users" >
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    {{user.displayName}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                /.well 
            </div>
        </div>-->
</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="container">
        <div class="row">
            <div class="col-sm-6 col-sm-offset-3 text-center">
                <h1>{{mode}} Task</h1>
                <form role="form" ng-submit="addUpdateTask(newTask)">
                    <div class="form-group">
                        <label for="titleInput">Task Title</label>
                        <input type="text" ng-model="newTask.title" class="form-control" id="titleInput" placeholder="Enter task title">
                    </div>
                    <div class="form-group">
                        <label for="descInput">Description</label>
                        <textarea ng-model="newTask.description" class="form-control" id="descInput" placeholder="Enter description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="priorityRadioGroup">Priority</label>
                        <div id="priorityRadioGroup" class="btn-group" data-toggle="buttons">
                            <label class="btn btn-success">
                                <input type="radio" autocomplete="off" value="0">Low
                            </label>
                            <label class="btn btn-info active">
                                <input type="radio" autocomplete="off" value="1" checked>Normal
                            </label>
                            <label class="btn btn-warning">
                                <input type="radio" value="2" autocomplete="off">High
                            </label>
                            <label class="btn btn-danger">
                                <input type="radio" value="3" autocomplete="off">Urgent
                            </label>
                        </div>
                    </div>
                    <div class="form-group well well-sm">
                        <label>Deadline</label>
                        <datetimepicker data-ng-model="newTask.deadline" ></datetimepicker>
                    </div>
                    <button type="submit" class="btn btn-default">Add Task</button>
                </form>
                <hr>
            </div>
        </div>
    </div>
</div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            